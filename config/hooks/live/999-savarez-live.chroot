#!/bin/bash
set -e

echo "[SavarezOS] Live hook start"

LIVEUSER=$(logname 2>/dev/null || echo live)

[ -z "$LIVEUSER" ] && LIVEUSER=live

mkdir -p /home/$LIVEUSER/Desktop

cat > /usr/share/applications/install-savarezos.desktop <<EOF
[Desktop Entry]
Type=Application
Name=Install SavarezOS
Exec=pkexec calamares
Icon=system-installer
Terminal=false
Categories=System;Installer;
EOF

chmod 755 /usr/share/applications/install-savarezos.desktop

cp /usr/share/applications/install-savarezos.desktop \
   /home/$LIVEUSER/Desktop/Install-SavarezOS.desktop

chmod +x /home/$LIVEUSER/Desktop/Install-SavarezOS.desktop
chown $LIVEUSER:$LIVEUSER /home/$LIVEUSER/Desktop/Install-SavarezOS.desktop

echo "[SavarezOS] Live hook done"
